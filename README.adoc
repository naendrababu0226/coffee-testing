= Effective Testing &amp; Test Automation

_This branch contains the StackGres examples_


== Kubernetes Installation

You'll need `kubectl`, `helm` &amp; `jq` installed.

=== StackGres Installation

Create a cluster with at least 2 nodes.
The examples have been tested on GKE.

----
# install the Prometheus Helm chart
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo add stable https://charts.helm.sh/stable
helm repo update
helm install --create-namespace --namespace monitoring \
  --set grafana.enabled=true \
  prometheus prometheus-community/kube-prometheus-stack

# install the StackGres operator
helm install --create-namespace --namespace stackgres stackgres-operator \
    --set grafana.autoEmbed=true \
    --set-string grafana.webHost=prometheus-grafana.monitoring \
    --set-string grafana.secretNamespace=monitoring \
    --set-string grafana.secretName=prometheus-grafana \
    --set-string grafana.secretUserKey=admin-user \
    --set-string grafana.secretPasswordKey=admin-password \
    stackgres-charts/stackgres-operator
----

=== Cluster Creation

----
# create a StackGres Postgres cluster
kubectl apply -f deployment/sgscript.yaml
kubectl apply -f deployment/sgcluster.yaml

# wait for start up
----

=== Application Deployment

----
# create the coffee-shop & barista app
kubectl apply -f deployment/barista.yaml
kubectl apply -f deployment/coffee-shop.yaml
----

=== Testing

You can access your application via the IP address that has been generated for your ingress:

----
kubectl get ingresses
----

List coffee orders:

----
curl http://<IP>/orders | jq .
----

Create a coffee order:

----
curl http://<IP>/orders -i -XPOST -H 'Content-Type: application/json' -d '{"type":"Espresso","origin":"Colombia"}'
curl http://<IP>/orders | jq .
----